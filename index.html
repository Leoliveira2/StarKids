<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SuperKids Local</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(to bottom right, #fce7f3, #fbcfe8);
      min-height: 100vh;
      font-family: 'Segoe UI', sans-serif;
    }
    .reward {
      animation: rewardAnim 1s ease-out;
    }
    @keyframes rewardAnim {
      0% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.5); opacity: 1; }
      100% { transform: scale(1); opacity: 0; }
    }
  </style>
</head>
<body>
  <div id="app" class="p-4 max-w-md mx-auto"></div>
  <div id="animation" class="fixed top-10 left-1/2 transform -translate-x-1/2 text-6xl pointer-events-none"></div>
  <script>
    const mascots = {
      star: { name: 'Stella', emoji: '‚≠ê' },
      dragon: { name: 'Drako', emoji: 'üêâ' },
      heart: { name: 'Cora√ß√£o', emoji: 'üíñ' },
      chancho: { name: 'Chancho', emoji: 'üßíüèΩ' },
      robot: { name: 'Robo', emoji: 'ü§ñ' },
      unicorn: { name: 'Uni', emoji: 'ü¶Ñ' }
    };

    const defaultActivities = [
      { name: 'Dormir no hor√°rio', description: 'Ir para a cama no hor√°rio combinado', points: 15 },
      { name: 'Escovar os dentes manh√£', description: 'Escova√ß√£o matinal completa', points: 10 },
      { name: 'Fazer o dever de casa', description: 'Completar todas as tarefas escolares', points: 20 }
    ];

    let currentUser = null;

    function saveUser(user) {
      localStorage.setItem('superkids_user', JSON.stringify(user));
    }

    function loadUser() {
      const data = localStorage.getItem('superkids_user');
      return data ? JSON.parse(data) : null;
    }

    function saveActivities(activities) {
      localStorage.setItem('superkids_activities', JSON.stringify(activities));
    }

    function loadActivities() {
      const data = localStorage.getItem('superkids_activities');
      return data ? JSON.parse(data) : [];
    }

    function showReward(emoji) {
      const anim = document.getElementById('animation');
      anim.textContent = emoji;
      anim.className = 'fixed top-10 left-1/2 transform -translate-x-1/2 text-6xl pointer-events-none reward';
      setTimeout(() => anim.textContent = '', 1000);
    }

    function completeActivity(index) {
      const activities = loadActivities();
      activities[index].status = 'completed';
      saveActivities(activities);

      currentUser.xp += activities[index].points;
      saveUser(currentUser);
      showReward('üéâ +' + activities[index].points + ' XP');
      renderDashboard();
    }

    function renderDashboard() {
      const activities = loadActivities();
      document.getElementById("app").innerHTML = `
        <div class="p-4 max-w-xl mx-auto">
          <h1 class="text-2xl font-bold mb-2">Bem-vindo, ${currentUser.name}!</h1>
          <p class="text-lg">Mascote: ${mascots[currentUser.mascot].emoji} ${mascots[currentUser.mascot].name}</p>
          <p class="text-sm">XP: ${currentUser.xp}</p>
          <button class="mt-4 bg-red-500 text-white px-4 py-2 rounded" onclick="logout()">Sair</button>
          <div id="activities" class="mt-6"></div>
        </div>
      `;

      let html = "<h2 class='text-xl font-semibold mb-2'>Atividades</h2>";
      activities.forEach((act, idx) => {
        html += `<div class='border p-3 mb-2 rounded ${act.status === 'completed' ? 'bg-green-100' : 'bg-white'}'>
          <div class='font-medium'>${act.name}</div>
          <div class='text-sm text-gray-600'>${act.description}</div>
          <div class='text-sm'>XP: ${act.points}</div>
          ${act.status === 'pending' ? `<button class='mt-2 bg-blue-500 text-white px-3 py-1 rounded' onclick='completeActivity(${idx})'>Concluir</button>` : '<div class="text-green-600 font-semibold">Conclu√≠da</div>'}
        </div>`;
      });
      document.getElementById("activities").innerHTML = html;
    }

    function logout() {
      localStorage.removeItem('superkids_user');
      renderLogin();
    }

    function renderLogin() {
      document.getElementById("app").innerHTML = `
        <div class="p-4 max-w-md mx-auto">
          <h1 class="text-2xl font-bold mb-4">Login</h1>
          <input type="text" id="name" placeholder="Nome" class="border p-2 rounded w-full mb-2" />
          <select id="mascot" class="border p-2 rounded w-full mb-4">
            ${Object.entries(mascots).map(([key, val]) => `<option value="${key}">${val.emoji} ${val.name}</option>`).join("")}
          </select>
          <select id="type" class="border p-2 rounded w-full mb-4">
            <option value="child">üë∂ Crian√ßa</option>
            <option value="parent">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Respons√°vel</option>
          </select>
          <button class="bg-green-500 text-white px-4 py-2 rounded w-full" id="loginBtn">Entrar</button>
          <p class="text-center text-sm text-gray-500 mt-2">Se for seu primeiro acesso, um perfil ser√° criado automaticamente.</p>
        </div>
      `;

      document.getElementById("loginBtn").addEventListener("click", () => {
        const name = document.getElementById("name").value.trim();
        const mascot = document.getElementById("mascot").value;
        const type = document.getElementById("type").value;

        if (!name) return alert("Digite seu nome");

        const existing = loadUser();
        if (existing && existing.name === name) {
          currentUser = existing;
        } else {
          currentUser = { name, mascot, xp: 0, type };
          saveUser(currentUser);
          if (type === 'child') {
            saveActivities(defaultActivities.map(act => ({ ...act, status: 'pending' })));
          }
        }

        if (currentUser.type === 'parent') {
          renderParentDashboard();
        } else {
          renderDashboard();
        }
      });
    }

    function renderParentDashboard() {
      const activities = loadActivities();
      document.getElementById("app").innerHTML = `
        <div class="p-4 max-w-xl mx-auto">
          <h1 class="text-2xl font-bold mb-2">Painel do Respons√°vel</h1>
          <p class="text-sm mb-4">Voc√™ pode editar ou adicionar atividades para seus filhos</p>
          <button class="mt-2 mb-4 bg-red-500 text-white px-4 py-2 rounded" onclick="logout()">Sair</button>
          <div id="activities"></div>
        </div>
      `;

      let html = "<h2 class='text-xl font-semibold mb-2'>Atividades</h2>";
      activities.forEach((act, idx) => {
        html += `<div class='border p-3 mb-2 rounded bg-white'>
          <input class='w-full font-medium mb-1 p-1 border rounded' value='${act.name}' onchange='updateActivity(${idx}, "name", this.value)' />
          <textarea class='w-full text-sm text-gray-700 p-1 border rounded mb-1' onchange='updateActivity(${idx}, "description", this.value)'>${act.description}</textarea>
          <input type='number' class='w-full text-sm p-1 border rounded' value='${act.points}' onchange='updateActivity(${idx}, "points", this.value)' />
        </div>`;
      });
      document.getElementById("activities").innerHTML = html;
    }

    function updateActivity(index, field, value) {
      const activities = loadActivities();
      activities[index][field] = field === 'points' ? parseInt(value) : value;
      saveActivities(activities);
    }

    document.addEventListener("DOMContentLoaded", () => {
      const savedUser = loadUser();
      if (savedUser) {
        currentUser = savedUser;
        if (currentUser.type === 'parent') {
          renderParentDashboard();
        } else {
          renderDashboard();
        }
      } else {
        renderLogin();
      }
    });
  </script>
</body>
</html>
