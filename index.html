<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
  <title>SuperKids - Plataforma Educacional Gamificada</title>
  <meta name="description" content="Transforme tarefas em aventuras divertidas para crian√ßas de 5 a 12 anos">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="safe-area-top safe-area-bottom">
<div id="app">
  <div class="min-h-screen bg-gradient-to-br from-blue-400 to-purple-600 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
      <div class="text-center">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">SuperKids</h1>
        <p class="text-gray-600 mb-4">Carregando aplica√ß√£o...</p>
        <div class="loading"></div>
      </div>
    </div>
  </div>
</div>
<script type="module">
// --- Firebase Modular SDK ---
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, doc, setDoc, getDoc, getDocs, addDoc, query, where } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getAuth, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

// Firebase config (YOURS)
const firebaseConfig = {
  apiKey: "AIzaSyBS8wfn5ICLIfBv4r8Ok4V5eG5jZog7sQg",
  authDomain: "superkids-4d0ca.firebaseapp.com",
  projectId: "superkids-4d0ca",
  storageBucket: "superkids-4d0ca.appspot.com",
  messagingSenderId: "512196800065",
  appId: "1:512196800065:web:378e4c4e43bff424bee0c0",
  measurementId: "G-NBZCJHCWRE"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// --- App State ---
let appState = {
  currentUser: null,
  users: [],
  activities: [],
  showLogin: true,
  loading: false,
  showAddActivity: false
};

let loginForm = { name: '', type: 'child', mascot: 'star' };
let activityForm = { name: '', description: '', points: 10, targetUserId: '' };
const mascots = {
  star:   { name: 'Stella', emoji: '‚≠ê', role: 'guide' },
  dragon: { name: 'Drako', emoji: 'üêâ', role: 'adventure' },
  heart:  { name: 'Cora√ß√£o', emoji: 'üíñ', role: 'love' },
  chancho:{ name: 'Chancho', emoji: 'üßíüèΩ', role: 'warrior' },
  robot:  { name: 'Robo', emoji: 'ü§ñ', role: 'tech' },
  unicorn:{ name: 'Uni', emoji: 'ü¶Ñ', role: 'magic' }
};
const defaultActivities = [
  { name: 'Dormir no hor√°rio', description: 'Ir para a cama no hor√°rio combinado', points: 15, icon: 'üò¥', category: 'health' },
  { name: 'Escovar os dentes manh√£', description: 'Escova√ß√£o matinal completa', points: 10, icon: 'ü™•', category: 'health' },
  { name: 'Escovar os dentes noite', description: 'Escova√ß√£o noturna completa', points: 10, icon: 'ü¶∑', category: 'health' },
  { name: 'Tomar caf√© da manh√£', description: 'Alimenta√ß√£o saud√°vel pela manh√£', points: 10, icon: 'ü•£', category: 'health' },
  { name: 'Chegar na escola no hor√°rio', description: 'Pontualidade escolar', points: 15, icon: 'üè´', category: 'education' },
  { name: 'Fazer o dever de casa', description: 'Completar todas as tarefas escolares', points: 20, icon: 'üìö', category: 'education' },
  { name: 'Ler por 15 minutos', description: 'Momento de leitura di√°ria', points: 15, icon: 'üìñ', category: 'education' },
  { name: 'Organizar o quarto', description: 'Guardar brinquedos e organizar espa√ßo', points: 10, icon: 'üßπ', category: 'social' }
];

// --- Firebase Logic ---
async function firebaseSignIn() {
  await signInAnonymously(auth);
}
function firebaseOnAuth(cb) {
  onAuthStateChanged(auth, cb);
}
async function saveUser(user) {
  await setDoc(doc(db, "users", user.id), user, { merge: true });
  return user;
}
async function getUsers() {
  const usersSnap = await getDocs(collection(db, "users"));
  return usersSnap.docs.map(doc => doc.data());
}
async function getUserByName(name) {
  const usersRef = collection(db, "users");
  const q = query(usersRef, where("name", "==", name));
  const snap = await getDocs(q);
  return snap.empty ? null : snap.docs[0].data();
}
async function saveActivity(activity) {
  if (!activity.id) {
    const docRef = await addDoc(collection(db, "activities"), activity);
    activity.id = docRef.id;
    await setDoc(doc(db, "activities", activity.id), activity, { merge: true });
  } else {
    await setDoc(doc(db, "activities", activity.id), activity, { merge: true });
  }
  return activity;
}
async function getActivities() {
  const actsSnap = await getDocs(collection(db, "activities"));
  return actsSnap.docs.map(doc => doc.data());
}

// --- UI Logic (Shortened for Brevity) ---
function render() {
  const app = document.getElementById('app');
  if (!app) return;
  if (appState.showLogin || !appState.currentUser) {
    app.innerHTML = `
      <div class="min-h-screen bg-gradient-to-br from-blue-400 to-purple-600 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full fade-in">
          <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">SuperKids</h1>
            <p class="text-gray-600">Sua aventura de aprendizado come√ßa aqui!</p>
          </div>
          <input type="text" id="login-name" placeholder="Digite seu nome" value="${loginForm.name}" class="w-full p-3 border-2 border-gray-200 rounded-xl mb-4"/>
          <button id="login-btn" class="w-full bg-blue-500 text-white p-3 rounded-xl font-semibold hover:bg-blue-600 transition-colors">üöÄ Entrar</button>
        </div>
      </div>
    `;
    document.getElementById('login-btn').onclick = handleLogin;
    document.getElementById('login-name').oninput = (e) => loginForm.name = e.target.value;
    document.getElementById('login-name').onkeypress = (e) => { if (e.key === 'Enter') handleLogin(); };
    return;
  }
  // (Very basic dashboard, expand as needed)
  app.innerHTML = `
    <div class="min-h-screen bg-gradient-to-br from-blue-400 to-purple-600 p-4">
      <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-lg p-6 mb-6">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center space-x-3">
            <div class="text-3xl">${mascots[appState.currentUser.mascot].emoji}</div>
            <div>
              <h1 class="text-2xl font-bold text-gray-800">Ol√°, ${appState.currentUser.name}!</h1>
            </div>
          </div>
          <button id="logout-btn" class="text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100 transition-colors">‚Ü©Ô∏è Sair</button>
        </div>
        <h2 class="text-xl font-bold text-gray-800 mb-4">üìã Atividades</h2>
        <div>${appState.activities.filter(a=>a.userId===appState.currentUser.id).map(a=>`
          <div class="p-3 mb-2 bg-gray-100 rounded">${a.icon||'üìù'} <b>${a.name}</b> - ${a.points} XP</div>
        `).join('')||'<div class="text-gray-500">Nenhuma atividade ainda.</div>'}</div>
        <button id="add-activity-btn" class="mt-4 w-full bg-blue-500 text-white p-3 rounded-xl font-semibold hover:bg-blue-600 transition-colors">‚ûï Nova Atividade</button>
      </div>
      <div id="modal" class="hidden"></div>
    </div>
  `;
  document.getElementById('logout-btn').onclick = logout;
  document.getElementById('add-activity-btn').onclick = showAddActivityModal;
}

function showAddActivityModal() {
  const modal = document.getElementById('modal');
  modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
  modal.innerHTML = `
    <div class="bg-white rounded-xl p-6 max-w-sm w-full">
      <h2 class="text-xl font-bold mb-4">‚ûï Nova Atividade</h2>
      <input type="text" id="activity-name" placeholder="Nome" class="w-full p-2 mb-2 border rounded" />
      <input type="text" id="activity-description" placeholder="Descri√ß√£o" class="w-full p-2 mb-2 border rounded" />
      <input type="number" id="activity-points" placeholder="XP" value="10" class="w-full p-2 mb-2 border rounded" />
      <button id="save-activity-btn" class="w-full bg-blue-500 text-white py-2 rounded mb-2">Salvar</button>
      <button id="close-modal-btn" class="w-full bg-gray-300 text-gray-700 py-2 rounded">Cancelar</button>
    </div>
  `;
  document.getElementById('close-modal-btn').onclick = hideModal;
  document.getElementById('save-activity-btn').onclick = async () => {
    const name = document.getElementById('activity-name').value;
    const description = document.getElementById('activity-description').value;
    const points = parseInt(document.getElementById('activity-points').value) || 10;
    if (!name) { alert('Nome obrigat√≥rio!'); return; }
    await saveActivity({
      userId: appState.currentUser.id,
      name, description, points,
      icon: "üìù",
      status: "pending",
      date: new Date().toISOString()
    });
    appState.activities = await getActivities();
    hideModal();
    render();
  };
}
function hideModal() {
  const modal = document.getElementById('modal');
  modal.className = 'hidden';
  modal.innerHTML = '';
}

function logout() {
  appState.currentUser = null;
  appState.showLogin = true;
  render();
}

async function handleLogin() {
  if (!loginForm.name.trim()) { alert('Digite seu nome!'); return; }
  appState.loading = true;
  render();
  await firebaseSignIn();
  let user = await getUserByName(loginForm.name.trim());
  if (!user) {
    const uid = auth.currentUser.uid;
    user = {
      id: uid,
      name: loginForm.name.trim(),
      type: loginForm.type,
      xp: 0,
      mascot: loginForm.mascot,
      achievements: [],
      createdAt: new Date().toISOString()
    };
    await saveUser(user);
    for (const activity of defaultActivities) {
      await saveActivity({ ...activity, userId: uid, status: 'pending', date: new Date().toISOString() });
    }
  }
  appState.currentUser = user;
  appState.activities = await getActivities();
  appState.showLogin = false;
  render();
}

// --- App Start ---
firebaseOnAuth(async user => {
  if (user) {
    appState.currentUser = null;
    appState.activities = await getActivities();
    render();
  } else {
    appState.showLogin = true;
    render();
  }
});

render();
</script>
</body>
</html>